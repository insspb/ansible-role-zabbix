---
- name: Zabbix | Configure | Zabbix agent general configuration
  become: yes
  template: 
    src: "{{ zabbix_install_version }}/zabbix_agentd.conf.j2"
    dest: "/etc/zabbix/zabbix_agentd.conf"
    mode: 0644
    backup: yes
  when: "{{ zabbix_install_agent }} == True"
  notify: Zabbix | Zabbix | Restart agent service

- name: Zabbix | Configure | Zabbix agent PSK encryprion configuration
  become: yes
  template: 
    src: "zabbix_agent.psk.j2"
    dest: "{{ zabbix_agent_TLSPSKFile }}"
    mode: 0644
    backup: yes
  when: zabbix_install_agent
        and zabbix_agent_TLSPSK != ""
        and zabbix_agent_TLSPSKIdentity != ""
  notify: Zabbix | Zabbix | Restart agent service

- name: Zabbix | Configure | Zabbix server
  become: yes
  template: 
    src: "{{ zabbix_install_version }}/zabbix_server.conf.j2"
    dest: "/etc/zabbix/zabbix_server.conf"
    mode: 0644
    backup: yes
  when: "{{ zabbix_install_server }} == True"
  notify: Zabbix | Zabbix | Restart server service

- name: Zabbix | Configure | Zabbix proxy general configuration
  become: yes
  template: 
    src: "{{ zabbix_install_version }}/zabbix_proxy.conf.j2"
    dest: "/etc/zabbix/zabbix_proxy.conf"
    mode: 0644
    backup: yes
  when: "{{ zabbix_install_proxy }} == True"
  notify: Zabbix | Zabbix | Restart proxy service

- name: Zabbix | Configure | Zabbix proxy PSK encryption configuration
  become: yes
  template: 
    src: "zabbix_proxy.psk.j2"
    dest: "{{ zabbix_proxy_TLSPSKFile }}"
    mode: 0644
    backup: yes
  when: zabbix_install_proxy
        and zabbix_proxy_TLSPSK != ""
        and zabbix_proxy_TLSPSKIdentity != ""
  notify: Zabbix | Zabbix | Restart proxy service
